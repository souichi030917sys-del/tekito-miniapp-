<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Sprint 1000</title>
  <style>
    :root {
      --bg: #f6f3eb;
      --panel: #fffcf6;
      --line: #d9d2c7;
      --text: #1f1f1f;
      --muted: #6f695f;
      --accent: #1f6f61;
      --accent-2: #b86b2a;
      --ok: #1c7c54;
      --ng: #b42318;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 20px;
      color: var(--text);
      font-family: "Yu Gothic", "Hiragino Kaku Gothic ProN", sans-serif;
      background:
        radial-gradient(circle at 15% 20%, #fbe2c4 0%, transparent 30%),
        radial-gradient(circle at 85% 80%, #cce8df 0%, transparent 30%),
        linear-gradient(140deg, #f7f4ea, #dceee8);
    }

    .card {
      width: min(820px, 100%);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 20px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.09);
      padding: 24px;
    }

    h1 {
      margin: 0;
      font-size: clamp(26px, 4.4vw, 42px);
      letter-spacing: 0.03em;
      line-height: 1.1;
      color: #0d3028;
    }

    .subtitle {
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 14px;
    }

    .word-wrap {
      margin: 18px 0 14px;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 22px;
      background: #fff;
      min-height: 140px;
      display: grid;
      align-content: center;
      gap: 8px;
    }

    .en {
      font-size: clamp(34px, 8vw, 68px);
      line-height: 1;
      font-weight: 800;
      color: var(--accent);
      word-break: break-word;
    }

    .meta {
      display: flex;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid var(--line);
      padding-top: 12px;
    }

    .badge {
      display: inline-block;
      border: 1px solid #bdd8d2;
      background: #e9f6f3;
      color: #245f54;
      border-radius: 999px;
      padding: 7px 12px;
      font-weight: 700;
      font-size: 13px;
    }

    .quiz {
      margin-top: 14px;
    }

    .action-row {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    input[type="text"] {
      flex: 1;
      min-width: 240px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 15px;
      background: #fff;
    }

    button {
      border: 0;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 700;
      transition: transform 0.15s ease, box-shadow 0.2s ease, filter 0.2s ease;
    }

    button:hover { transform: translateY(-1px); }
    button:focus-visible {
      outline: 3px solid #111;
      outline-offset: 2px;
    }

    .primary {
      background: #111;
      color: #ffef00;
      font-size: 18px;
      padding: 14px 22px;
      min-width: 220px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }

    .primary:hover {
      filter: brightness(1.08);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.35);
    }

    .secondary {
      background: #0f6b5e;
      color: #fff;
      padding: 11px 16px;
    }

    .tertiary {
      background: #ede5d9;
      color: #5b422b;
      padding: 10px 14px;
    }

    .result {
      min-height: 1.4em;
      font-size: 14px;
      font-weight: 700;
      margin-top: 10px;
    }

    .ok { color: var(--ok); }
    .ng { color: var(--ng); }

    .explain {
      margin-top: 14px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: #fff;
      padding: 14px;
      display: none;
    }

    .explain.visible { display: block; }

    .explain h2 {
      margin: 0 0 8px;
      font-size: 16px;
      color: var(--accent-2);
    }

    .explain p,
    .explain li {
      margin: 0;
      font-size: 14px;
      line-height: 1.6;
    }

    .explain ul {
      margin: 6px 0 0;
      padding-left: 18px;
    }

    .section {
      margin-top: 10px;
    }

    @media (max-width: 560px) {
      .card { padding: 16px; }
      .action-row { flex-direction: column; align-items: stretch; }
      button { width: 100%; }
      .primary { min-width: 0; }
      input[type="text"] { min-width: 0; }
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>大学受験AI英単語1,000</h1>
    <p class="subtitle">大学受験頻出語を想定した1000語（動詞300 / 名詞400 / 形容詞・副詞300）</p>

    <section class="word-wrap">
      <div id="en" class="en">loading...</div>
    </section>

    <div class="meta">
      <div><span id="setInfo" class="badge">読み込み中...</span></div>
      <div>
        <span id="count">1 / 1000</span>
        <span> | 正答率 <strong id="accuracy">0%</strong></span>
      </div>
    </div>

    <div class="quiz">
      <input id="answer" type="text" placeholder="意味を日本語で入力" maxlength="50" />
    </div>

    <div class="action-row">
      <button id="checkBtn" class="primary">答え合わせ</button>
      <button id="showBtn" class="secondary">答えを表示</button>
    </div>

    <p id="result" class="result"></p>

    <div class="action-row">
      <button id="nextBtn" class="tertiary">次の単語</button>
      <button id="explainBtn" class="tertiary">解説を表示</button>
      <button id="shuffleBtn" class="tertiary">順番シャッフル</button>
      <button id="resetBtn" class="tertiary">成績リセット</button>
    </div>

    <section id="explain" class="explain">
      <h2>解説</h2>
      <p id="partLine"></p>

      <div class="section">
        <p><strong>複数の意味</strong></p>
        <ul id="meaningList"></ul>
      </div>

      <div class="section">
        <p><strong>用法メモ</strong></p>
        <ul id="usageList"></ul>
      </div>

      <div class="section">
        <p><strong>例文</strong></p>
        <p id="exampleEn"></p>
        <p id="exampleJa"></p>
      </div>
    </section>
  </main>

  <script src="data/vocab1000.js"></script>
  <script>
    const entries = Array.isArray(window.VOCAB_DATA) ? window.VOCAB_DATA : [];

    const enEl = document.getElementById("en");
    const answerEl = document.getElementById("answer");
    const resultEl = document.getElementById("result");
    const countEl = document.getElementById("count");
    const accuracyEl = document.getElementById("accuracy");
    const setInfoEl = document.getElementById("setInfo");

    const explainEl = document.getElementById("explain");
    const partLineEl = document.getElementById("partLine");
    const meaningListEl = document.getElementById("meaningList");
    const usageListEl = document.getElementById("usageList");
    const exampleEnEl = document.getElementById("exampleEn");
    const exampleJaEl = document.getElementById("exampleJa");

    const checkBtn = document.getElementById("checkBtn");
    const showBtn = document.getElementById("showBtn");
    const nextBtn = document.getElementById("nextBtn");
    const explainBtn = document.getElementById("explainBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const resetBtn = document.getElementById("resetBtn");

    let order = [];
    let index = 0;
    let current = null;

    const score = JSON.parse(localStorage.getItem("wordSprint1000Score") || "{\"total\":0,\"correct\":0}");

    function normalize(text) {
      return String(text || "").trim().replace(/\s+/g, "").replace(/[・'"「」『』（）()]/g, "");
    }

    function renderAccuracy() {
      const rate = score.total === 0 ? 0 : Math.round((score.correct / score.total) * 100);
      accuracyEl.textContent = `${rate}%`;
      localStorage.setItem("wordSprint1000Score", JSON.stringify(score));
    }

    function partLabel(part) {
      if (part === "verb") return "動詞";
      if (part === "noun") return "名詞";
      return "形容詞・副詞";
    }

    function buildSetInfo() {
      const counts = entries.reduce((acc, e) => {
        acc[e.part] = (acc[e.part] || 0) + 1;
        return acc;
      }, {});
      setInfoEl.textContent = `動詞 ${counts.verb || 0} / 名詞 ${counts.noun || 0} / 形容詞・副詞 ${counts.modifier || 0}`;
    }

    function shuffleOrder() {
      order = Array.from({ length: entries.length }, (_, i) => i);
      for (let i = order.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [order[i], order[j]] = [order[j], order[i]];
      }
      index = 0;
    }

    function fillList(element, items) {
      element.innerHTML = "";
      items.forEach((item) => {
        const li = document.createElement("li");
        li.textContent = item;
        element.appendChild(li);
      });
    }

    function renderExplanation() {
      if (!current) return;

      partLineEl.textContent = `品詞: ${partLabel(current.part)}`;
      fillList(meaningListEl, current.meanings || []);
      fillList(usageListEl, current.usage || []);

      exampleEnEl.textContent = `EN: ${current.example?.en || ""}`;
      exampleJaEl.textContent = `JA: ${current.example?.ja || ""}`;
    }

    function showWord() {
      if (entries.length === 0) {
        enEl.textContent = "データ読み込みに失敗しました";
        return;
      }

      if (index >= order.length) shuffleOrder();

      current = entries[order[index]];
      index += 1;

      enEl.textContent = current.word;
      answerEl.value = "";
      resultEl.textContent = "";
      resultEl.className = "result";
      countEl.textContent = `${index} / ${entries.length}`;

      renderExplanation();
      explainEl.classList.remove("visible");
      explainBtn.textContent = "解説を表示";
      answerEl.focus();
    }

    function isCorrectAnswer(input, meanings) {
      const ans = normalize(input);
      if (!ans) return false;
      return meanings.some((m) => {
        const key = normalize(m);
        return key.includes(ans) || ans.includes(key);
      });
    }

    function checkAnswer() {
      if (!current) return;
      score.total += 1;

      const ok = isCorrectAnswer(answerEl.value, current.meanings || []);
      if (ok) {
        score.correct += 1;
        resultEl.textContent = `正解: ${current.meanings[0]}`;
        resultEl.className = "result ok";
      } else {
        resultEl.textContent = `不正解: ${current.meanings.join(" / ")}`;
        resultEl.className = "result ng";
      }

      renderAccuracy();
    }

    function revealAnswer() {
      if (!current) return;
      resultEl.textContent = `答え: ${current.meanings.join(" / ")}`;
      resultEl.className = "result";
    }

    checkBtn.addEventListener("click", checkAnswer);
    showBtn.addEventListener("click", revealAnswer);
    nextBtn.addEventListener("click", showWord);

    explainBtn.addEventListener("click", () => {
      const visible = explainEl.classList.toggle("visible");
      explainBtn.textContent = visible ? "解説を隠す" : "解説を表示";
    });

    shuffleBtn.addEventListener("click", () => {
      shuffleOrder();
      showWord();
    });

    resetBtn.addEventListener("click", () => {
      score.total = 0;
      score.correct = 0;
      renderAccuracy();
      resultEl.textContent = "成績をリセットしました";
      resultEl.className = "result";
    });

    answerEl.addEventListener("keydown", (event) => {
      if (event.key === "Enter") checkAnswer();
    });

    buildSetInfo();
    shuffleOrder();
    showWord();
    renderAccuracy();
  </script>
</body>
</html>
